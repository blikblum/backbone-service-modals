{"version":3,"file":"marionette.modalservice.js","sources":["../src/service.js","../src/bootstrap-views.js","../src/bootstrap.js"],"sourcesContent":["import Service from 'radio.service'\r\nimport _ from 'underscore'\r\n\r\n/**\r\n * @class ModalService\r\n */\r\nconst ModalService = Service.extend({\r\n\r\n  /**\r\n   * @abstract\r\n   * @method requests\r\n   */\r\n  requests () {\r\n    return {\r\n      open: 'open',\r\n      close: 'close',\r\n      alert: 'alert',\r\n      confirm: 'confirm',\r\n      prompt: 'prompt',\r\n      dialog: 'dialog'\r\n    }\r\n  },\r\n\r\n  /**\r\n   * @constructs ModalService\r\n   */\r\n  constructor () {\r\n    this.views = []\r\n\r\n    Service.prototype.constructor.apply(this, arguments)\r\n  },\r\n\r\n  /**\r\n   * @method open\r\n   * @param {Backbone.View} [view]\r\n   * @returns {Promise}\r\n   */\r\n  open (view, options) {\r\n    let previousView\r\n    return Promise.resolve().then(() => {\r\n      this.trigger('before:open', view, options)\r\n      this._isOpen = true\r\n\r\n      previousView = _.last(this.views)\r\n      this.views.push(view)\r\n\r\n      return this.render(view, options)\r\n    }).then(() => {\r\n      if (previousView) {\r\n        return this.animateSwap(previousView, view, options)\r\n      } else {\r\n        return this.animateIn(view, options)\r\n      }\r\n    }).then(() => {\r\n      this.trigger('open', view, options)\r\n    })\r\n  },\r\n\r\n  /**\r\n   * @method close\r\n   * @param {Backbone.View} [view]\r\n   * @returns {Promise}\r\n   */\r\n  close (view, options) {\r\n    let previousView\r\n    let views\r\n\r\n    return Promise.resolve().then(() => {\r\n      if (view) {\r\n        this.trigger('before:close', view, options)\r\n      } else {\r\n        _.map(this.views, view => this.trigger('before:close', view, options))\r\n      }\r\n\r\n      this._isOpen = false\r\n\r\n      if (view) {\r\n        views = this.views = _.without(this.views, view)\r\n      } else {\r\n        views = this.views\r\n        this.views = []\r\n      }\r\n\r\n      previousView = _.last(views)\r\n\r\n      if (view && previousView) {\r\n        return this.animateSwap(view, previousView, options)\r\n      } else if (view) {\r\n        return this.animateOut(view, options)\r\n      } else if (previousView) {\r\n        return this.animateOut(previousView, options)\r\n      }\r\n    }).then(() => {\r\n      if (view) {\r\n        return this.remove(view, options)\r\n      } else {\r\n        return Promise.all(_.map(views, view => this.remove(view, options)))\r\n      }\r\n    }).then(() => {\r\n      if (view) {\r\n        this.trigger('close', view, options)\r\n      } else {\r\n        _.map(views, view => this.trigger('close', view, options))\r\n      }\r\n    })\r\n  },\r\n\r\n  /**\r\n   * @method alert\r\n   * @param {Object} [options]\r\n   * @returns {Promise}\r\n   */\r\n  alert (options) {\r\n    return new Promise((resolve, reject) => {\r\n      let view = new this.AlertView(options)\r\n      let promise = this.open(view, options)\r\n\r\n      this.trigger('before:alert', view, options)\r\n\r\n      view.on('confirm cancel', () => {\r\n        promise\r\n          .then(() => this.close(view, options))\r\n          .then(() => this.trigger('alert', null, view, options))\r\n          .then(() => resolve(), reject)\r\n      })\r\n    })\r\n  },\r\n\r\n  /**\r\n   * @method confirm\r\n   * @param {Object} [options]\r\n   * @returns {Promise}\r\n   */\r\n  confirm (options) {\r\n    return new Promise((resolve, reject) => {\r\n      let view = new this.ConfirmView(options)\r\n      let promise = this.open(view, options)\r\n\r\n      this.trigger('before:confirm', view, options)\r\n\r\n      let close = result => {\r\n        promise\r\n          .then(() => this.close(view, options))\r\n          .then(() => this.trigger('confirm', result, view, options))\r\n          .then(() => resolve(result), reject)\r\n      }\r\n\r\n      view.on({\r\n        confirm: () => close(true),\r\n        cancel: () => close(false)\r\n      })\r\n    })\r\n  },\r\n\r\n  /**\r\n   * @method prompt\r\n   * @returns {Promise}\r\n   */\r\n  prompt (options) {\r\n    return new Promise((resolve, reject) => {\r\n      let view = new this.PromptView(options)\r\n      let promise = this.open(view, options)\r\n\r\n      this.trigger('before:prompt', view, options)\r\n\r\n      let close = result => {\r\n        promise\r\n          .then(() => this.close(view, options))\r\n          .then(() => this.trigger('prompt', result, view, options))\r\n          .then(() => resolve(result), reject)\r\n      }\r\n\r\n      view.on({\r\n        submit: text => close(text),\r\n        cancel: () => close()\r\n      })\r\n    })\r\n  },\r\n\r\n  dialog (view, options) {\r\n    if (!view) {\r\n      throw new Error('ModalService: no view option passed to dialog')\r\n    }\r\n    return new Promise((resolve, reject) => {\r\n      let promise = this.open(view, options)\r\n\r\n      this.trigger('before:dialog', view, options)\r\n\r\n      let close = result => {\r\n        promise\r\n          .then(() => this.close(view, options))\r\n          .then(() => this.trigger('dialog', result, view, options))\r\n          .then(() => resolve(result), reject)\r\n      }\r\n\r\n      view.on({\r\n        submit: data => close(data),\r\n        cancel: () => close()\r\n      })\r\n    })\r\n  },\r\n\r\n  /**\r\n   * @method isOpen\r\n   * @returns {Boolean}\r\n   */\r\n  isOpen () {\r\n    return !!this._isOpen\r\n  },\r\n\r\n  /**\r\n   * @abstract\r\n   * @method render\r\n   */\r\n  render () {},\r\n\r\n  /**\r\n   * @abstract\r\n   * @method remove\r\n   */\r\n  remove () {},\r\n\r\n  /**\r\n   * @abstract\r\n   * @method animateIn\r\n   */\r\n  animateIn () {},\r\n\r\n  /**\r\n   * @abstract\r\n   * @method animateSwap\r\n   */\r\n  animateSwap () {},\r\n\r\n  /**\r\n   * @abstract\r\n   * @method animateOut\r\n   */\r\n  animateOut () {}\r\n})\r\n\r\nexport default ModalService\r\n","import {Model} from 'backbone'\r\nimport {View} from 'backbone.marionette'\r\n\r\nconst defaultCaptions = {\r\n  ok: 'OK',\r\n  cancel: 'Cancel',\r\n  yes: 'Yes',\r\n  no: 'No'\r\n}\r\n\r\nconst ModalView = View.extend({\r\n  initialize (options = {}) {\r\n    this.model = new Model(options)\r\n  },\r\n\r\n  triggers: {\r\n    'click .btn-primary': {event: 'confirm', preventDefault: false, stopPropagation: false},\r\n    'click .btn-secondary': 'cancel',\r\n    'click .close': 'cancel'\r\n  },\r\n\r\n  events: {\r\n    submit: 'submit'\r\n  },\r\n\r\n  submit (e) {\r\n    e.preventDefault()\r\n    var val = this.$('input').val()\r\n    this.trigger('submit', val)\r\n  }\r\n})\r\n\r\n// simple renderer for deafult views\r\nconst renderer = (template, data) => template(data)\r\n\r\nconst LayoutView = ModalView.extend({\r\n  className: 'modal fade',\r\n\r\n  attributes: {\r\n    'tabindex': -1,\r\n    'role': 'dialog'\r\n  },\r\n\r\n  template: function renderLayout () {\r\n    return `\r\n    <div class=\"modal-dialog\">\r\n      <div class=\"modal-content\"></div>\r\n    </div>\r\n    `\r\n  }\r\n}).setRenderer(renderer)\r\n\r\nconst AlertView = ModalView.extend({\r\n  template: function renderAlert (data) {\r\n    return `\r\n    <div class=\"modal-header\">\r\n      <h5 class=\"modal-title\">${data.title}</h5>\r\n      <button type=\"button\" class=\"close\" aria-hidden=\"true\">&times;</button>      \r\n    </div>\r\n\r\n    <div class=\"modal-body\">\r\n      <p>${data.text}</p>\r\n    </div>\r\n\r\n    <div class=\"modal-footer\">\r\n      <button type=\"button\" class=\"btn btn-primary\">${data.ok || defaultCaptions.ok}</button>\r\n    </div>\r\n    `\r\n  }\r\n}).setRenderer(renderer)\r\n\r\nconst PromptView = ModalView.extend({\r\n  tagName: 'form',\r\n\r\n  template: function renderPrompt (data) {\r\n    return `\r\n    <div class=\"modal-header\">\r\n      <h5 class=\"modal-title\">${data.title}</h5>\r\n      <button type=\"button\" class=\"close\" aria-hidden=\"true\">&times;</button>      \r\n    </div>\r\n\r\n    <div class=\"modal-body\">\r\n      <div class=\"form-group\">\r\n        <label for=\"modal__input--prompt\">${data.text}</label>\r\n        <input id=\"modal__input--prompt\" class=\"form-control\" type=\"text\" value=\"${data.value || ''}\">\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"modal-footer\">\r\n      <button type=\"button\" class=\"btn btn-secondary\">${data.cancel || defaultCaptions.cancel}</button>\r\n      <button type=\"submit\" class=\"btn btn-primary\">${data.ok || defaultCaptions.ok}</button>\r\n    </div>\r\n    `\r\n  }\r\n}).setRenderer(renderer)\r\n\r\nconst ConfirmView = ModalView.extend({\r\n  template: function renderConfirm (data) {\r\n    return `\r\n    <div class=\"modal-header\">\r\n      <h5 class=\"modal-title\">${data.title}</h5>\r\n      <button type=\"button\" class=\"close\" aria-hidden=\"true\">&times;</button>      \r\n    </div>\r\n    \r\n    <div class=\"modal-body\">\r\n      <p>${data.text}</p>\r\n    </div>\r\n    \r\n    <div class=\"modal-footer\">\r\n      <button type=\"button\" class=\"btn btn-secondary\">${data.no || defaultCaptions.no}</button>\r\n      <button type=\"button\" class=\"btn btn-primary\">${data.yes || defaultCaptions.yes}</button>\r\n    </div>      \r\n    `\r\n  }\r\n\r\n}).setRenderer(renderer)\r\n\r\nexport {ModalView, AlertView, LayoutView, ConfirmView, PromptView, defaultCaptions}\r\n","import ModalService from './service'\r\nimport { View, Region, mergeOptions } from 'backbone.marionette'\r\nimport { ModalView, LayoutView, AlertView, PromptView, ConfirmView, defaultCaptions } from './bootstrap-views'\r\n\r\nconst viewClassesNames = ['LayoutView', 'AlertView', 'PromptView', 'ConfirmView']\r\n\r\nconst BootstrapModalService = ModalService.extend({\r\n  LayoutView,\r\n  AlertView,\r\n  PromptView,\r\n  ConfirmView,\r\n\r\n  _prepareViewClasses () {\r\n    viewClassesNames.forEach(className => {\r\n      let ViewClass = this[className]\r\n      if (typeof ViewClass !== 'function') {\r\n        throw new Error(`ModalService: expected ${className} to be a template function or View class`)\r\n      }\r\n      if (!(ViewClass.prototype instanceof View)) {\r\n        ViewClass = ModalView.extend({\r\n          template: ViewClass\r\n        })\r\n        this[className] = ViewClass\r\n      }\r\n    })\r\n  },\r\n\r\n  setup (options = {}) {\r\n    mergeOptions(this, options, viewClassesNames.concat(['el', 'container']))\r\n    this._prepareViewClasses()\r\n  },\r\n\r\n  start () {\r\n    const layout = this.layout = new this.LayoutView()\r\n\r\n    if (!this.container) {\r\n      if (!this.el) throw new Error('ModalService: container or el options must be defined')\r\n\r\n      this.container = new Region({\r\n        el: this.el\r\n      })\r\n    }\r\n    this.container.show(layout)\r\n\r\n    layout.$el.modal({\r\n      show: false,\r\n      backdrop: 'static'\r\n    })\r\n\r\n    layout.$el.on({\r\n      'shown.bs.modal': (e) => this.trigger('modal:show', e),\r\n      'hidden.bs.modal': (e) => this.trigger('modal:hide', e)\r\n    })\r\n\r\n    this.contentRegion = new Region({\r\n      el: layout.$('.modal-content')\r\n    })\r\n  },\r\n\r\n  render (view) {\r\n    this.contentRegion.show(view)\r\n  },\r\n\r\n  remove () {\r\n    this.contentRegion.empty()\r\n  },\r\n\r\n  animateIn () {\r\n    return new Promise(resolve => {\r\n      this.once('modal:show', resolve)\r\n      this.layout.$el.modal('show')\r\n    })\r\n  },\r\n\r\n  animateOut () {\r\n    return new Promise(resolve => {\r\n      this.once('modal:hide', resolve)\r\n      this.layout.$el.modal('hide')\r\n    })\r\n  }\r\n},\r\n// class methods\r\n{\r\n  setCaptions (captions = {}) {\r\n    Object.assign(defaultCaptions, captions)\r\n  }\r\n})\r\n\r\nexport default BootstrapModalService\r\n"],"names":["ModalService","Service","extend","requests","open","close","alert","confirm","prompt","dialog","constructor","views","prototype","apply","arguments","view","options","previousView","Promise","resolve","then","trigger","_isOpen","_","last","push","render","animateSwap","animateIn","map","without","animateOut","remove","all","reject","AlertView","promise","on","ConfirmView","result","cancel","PromptView","submit","text","Error","data","isOpen","defaultCaptions","ok","yes","no","ModalView","View","initialize","model","Model","triggers","event","preventDefault","stopPropagation","events","e","val","$","renderer","template","LayoutView","className","attributes","renderLayout","setRenderer","renderAlert","title","tagName","renderPrompt","value","renderConfirm","viewClassesNames","BootstrapModalService","_prepareViewClasses","forEach","ViewClass","setup","mergeOptions","concat","start","layout","container","el","Region","show","$el","modal","backdrop","contentRegion","empty","once","setCaptions","captions","Object","assign"],"mappings":"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"}